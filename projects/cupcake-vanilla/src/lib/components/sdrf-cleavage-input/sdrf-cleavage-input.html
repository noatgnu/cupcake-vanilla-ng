<form [formGroup]="cleavageForm" class="cleavage-input-form">

  <!-- Search Type Selection for Typeahead -->
  @if (templateId || columnId) {
    <div class="mb-3">
      <small class="text-muted d-block mb-1">Search Mode for Name of Term:</small>
      <div class="btn-group btn-group-sm" role="group">
        <button
          type="button"
          class="btn"
          [class]="searchType() === 'icontains' ? 'btn-primary' : 'btn-outline-primary'"
          (click)="onSearchTypeChange('icontains')">
          <i class="bi bi-search me-1"></i>Contains
        </button>
        <button
          type="button"
          class="btn"
          [class]="searchType() === 'istartswith' ? 'btn-primary' : 'btn-outline-primary'"
          (click)="onSearchTypeChange('istartswith')">
          <i class="bi bi-arrow-right me-1"></i>Starts with
        </button>
      </div>
    </div>
  }

  <div class="row g-3">

    <!-- Name of Term (NT) - Required -->
    <div class="col-md-6">
      <label for="NT" class="form-label">
        Name of Term <span class="text-danger">*</span>
        <small class="text-muted">(NT)</small>
      </label>
      <input
        type="text"
        class="form-control"
        id="NT"
        formControlName="NT"
        placeholder="e.g., Trypsin, Chymotrypsin"
        [ngbTypeahead]="searchCleavageTerms"
        [resultFormatter]="formatOntologySuggestion"
        [inputFormatter]="formatOntologySuggestion"
        (selectItem)="onOntologySuggestionSelected($event)"
        [editable]="true"
        [showHint]="true"
        [focusFirst]="false"
        container="body"
        [class.is-invalid]="cleavageForm.get('NT')?.invalid && cleavageForm.get('NT')?.touched">
      <div class="form-text">
        @if (templateId || columnId) {
          Typeahead search: {{ searchType() === 'icontains' ? 'Contains' : 'Starts with' }} mode
        } @else {
          Cleavage agent name (uses ontology typeahead when available)
        }
      </div>
      <div class="invalid-feedback">
        Name of Term is required
      </div>
    </div>

    <!-- Accession (AC) -->
    <div class="col-md-6">
      <label for="AC" class="form-label">
        Accession <small class="text-muted">(AC)</small>
      </label>
      <input
        type="text"
        class="form-control"
        id="AC"
        formControlName="AC"
        placeholder="e.g., PSI-MS:1001251">
      <div class="form-text">PSI-MS or other ontology accession</div>
    </div>

    <!-- Cleavage Site (CS) -->
    <div class="col-md-12">
      <label for="CS" class="form-label">
        Cleavage Site <small class="text-muted">(CS)</small>
      </label>
      <input
        type="text"
        class="form-control"
        id="CS"
        formControlName="CS"
        placeholder="e.g., (?<=[KR])(?![P])">
      <div class="form-text">Regular expression pattern for cleavage site specificity</div>
    </div>

  </div>

  <!-- Preview -->
  @if (cleavageForm.valid && cleavageForm.get('NT')?.value) {
    <div class="mt-3 p-2 bg-body-secondary border rounded">
      <small class="text-muted fw-semibold">Preview:</small>
      <div class="font-monospace small">{{ value || 'Building...' }}</div>
    </div>
  }

  <!-- Validation Summary -->
  @if (cleavageForm.invalid && cleavageForm.touched) {
    <div class="alert alert-warning mt-3">
      <small>
        <i class="bi bi-exclamation-triangle me-1"></i>
        <strong>Required field:</strong> Name of Term (NT) must be filled.
      </small>
    </div>
  }
</form>
